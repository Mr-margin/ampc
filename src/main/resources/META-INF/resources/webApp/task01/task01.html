<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title></title>
  <link href="../../css/icons.css" rel="stylesheet" />
  <link href="../../css/plugins/sprflat-theme/jquery.ui.all.css" rel="stylesheet" />
  <link href="../../css/bootstrap.min.css" rel="stylesheet" />
  <!--<link rel="stylesheet" href="../../css/plugins/iCheck/custom.css"/>-->
  <link rel="stylesheet" href="../../js/plugins/forms/icheck/flat/_all.css"/>
  <link rel="stylesheet" href="../../css/plugins/bootstrap-table/bootstrap-table.min.css"/>
  <link rel="stylesheet" href="../../css/plugins/sweetalert/sweetalert.css"/>
  <link href="../../css/main.css" rel="stylesheet" />
  <style>
    #rwToolbar,#qjToolbar{
      margin: 10px;
    }
  </style>
</head>
<body>

  <div class="content">
    <div class="row">
      <div class="col-md-6 pr0">
        <div class="panel panel-default plain ">
          <!-- Start .panel -->
          <div class="panel-heading white-bg" style="border: none">
            <div class="col-md-6">
              <h4 class="panel-title">任务列表<i class="im-file3"></i></h4>
            </div>
          </div>
          <div class="panel-body" style="padding:0px;border-right: none">
            <div id="rwToolbar" class="btn-group">
              <div class="col-md-6">
                <button type="button" class="btn btn-default">
                  <i class="glyphicon glyphicon-plus"></i> 创建
                </button>
                <button disabled type="button" class="btn btn-default rwDel" onclick="deleteFun('rw')">
                  <i class="glyphicon glyphicon-trash"></i> 删除
                </button>
              </div>
              <div class="input-group col-md-4 col-md-offset-8">
                <input type="text" class="form-control rw " placeholder="输入任务名称或字段">
                <span class="input-group-btn">
                  <button class="btn btn-default " type="button" onclick="search('rw')"><i class="ec-search"></i></button>
                </span>
              </div><!-- /input-group -->
            </div>
            <table id="rwTable">
              <thead>
                <tr class="info">
                  <th data-checkbox="true">   </th>
                  <th data-formatter="rwName">任务名称</th>
                  <th data-formatter="rwDomain">模拟范围</th>
                  <th data-field="esNationName">清单</th>
                </tr>
              </thead>
            </table>
          </div>
        </div>
      </div>
      <div class="col-md-6 pl0">
        <div class="panel panel-default plain " >
          <!-- Start .panel -->
          <div class="panel-heading white-bg" style="border: none">
            <div class="col-md-6">
              <h4 class="panel-title">情景列表<i class="im-file3"></i></h4>
            </div>
          </div>
          <div class="panel-body" style="padding:0px;border-left: none; ">
            <div id="qjToolbar" class="btn-group">
              <div class="col-md-6">
                <button type="button" class="btn btn-default">
                  <i class="glyphicon glyphicon-plus"></i> 创建
                </button>
                <button disabled type="button" class="btn btn-default qjDel" onclick="deleteFun('qj')">
                  <i class="glyphicon glyphicon-trash"></i> 删除
                </button>
              </div>
              <div class="input-group col-md-4 col-md-offset-8">
                <input type="text" class="form-control qj " placeholder="输入情景名称或字段">
                <span class="input-group-btn">
                  <button class="btn btn-default " type="button" onclick="search('qj')"><i class="ec-search"></i></button>
                </span>
              </div><!-- /input-group -->
            </div>
            <table id="qjTable">
              <thead>
                <tr>
                  <th data-checkbox="true">   </th>
                  <th data-formatter="qjName">情景名称</th>
                  <th data-formatter="qjOrder">操作</th>
                  <th data-field="scenarinoStatus">情景状态</th>
                  <th data-formatter="qjEffectEvaluation"></th>
                </tr>
              </thead>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
  <ul id="RWcontext-menu" class="dropdown-menu">
    <li data-item="rename"><a href="#">修改名称</a></li>
    <!--<li data-item="delete"><a>Delete</a></li>-->
    <!--<li data-item="action1"><a>Action Here</a></li>-->
    <!--<li data-item="action2"><a>And Action Here</a></li>-->
  </ul>
  <ul id="QJcontext-menu" class="dropdown-menu">
    <li data-item="rename"><a href="#">修改名称</a></li>
    <!--<li data-item="delete"><a>Delete</a></li>-->
    <!--<li data-item="action1"><a>Action Here</a></li>-->
    <!--<li data-item="action2"><a>And Action Here</a></li>-->
  </ul>



</body>
<script src="../../js/jquery.min.js"></script>
<script>
  window.jQuery || document.write('<script src="../../js/jquery.min.js">\x3C/script>')
</script>
<script src="../../js/jquery-ui-1.10.4.min.js"></script>
<script src="../../js/plugins/forms/icheck/jquery.icheck.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<script src="../../js/plugins/bootstrap-table/bootstrap-table.min.js"></script>
<script src="../../js/plugins/bootstrap-table/bootstrap-table-mobile.min.js"></script>
<script src="../../js/plugins/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>

<script src="../../js/plugins/sweetalert/sweetalert.min.js"></script>
<script src="../../js/bootstrap-table-contextmenu.js.js"></script>
<script>
  var userId = 111;
  var selectRW;
  var delRWid={},delQJid={};
  var parameterPar = {total:'',data:{}};
  function refreshIcheck(){
    var callbacks_list = $('.rwTable ul');
    $('body input').on('ifCreated ifClicked ifChanged ifChecked ifUnchecked ifDisabled ifEnabled ifDestroyed', function(event){
      callbacks_list.prepend('<li><span>#' + this.id + '</span> is ' + event.type.replace('if', '').toLowerCase() + '</li>');
    }).iCheck({
      checkboxClass: 'icheckbox_flat-aero',
      radioClass: 'iradio_flat-aero',
      increaseArea: '20%'
    });
  }


  /*看名字*/
  function ajaxPost(url,parameter){
    parameterPar.data = parameter;
    var p = JSON.stringify(parameterPar);
    return $.ajax(url,{
      contentType:"application/json",
      type: "POST",
      async:true,
      dataType: 'JSON',
      data: p
    })
  }

  $(document).ready(function(){
    initialize();
  });

  function initialize(){
    initRwTable();
  }

  function initRwTable(){
    $('#rwTable').bootstrapTable({
      method : 'POST',
      url : 'rw.json',
      dataType : "json",
      contentType : "application/json", // 请求远程数据的内容类型。
      toobar:'#rwToolbar',
      iconSize : "outline",
      search:false,
      searchAlign:'right',
//      height:500,
      maintainSelected:true,
      clickToSelect : false,// 点击选中行
      pagination : true, // 在表格底部显示分页工具栏
      pageSize : 10, // 页面大小
      pageNumber : 1, // 页数
      pageList : [10],
      striped : true, // 使表格带有条纹
      sidePagination : "server",// 表格分页的位置 client||server
      rowStyle:function(row,index){
        if(index == 0){
          return {
            classes: 'info'
          };
        }
        return {};
      },
      queryParams : function formPm(m){
        var json = {
          "token": "",
          "data": {
            "missionName": m.searchText||'',
            "pageNum": m.pageNumber,
            "pageSize": m.pageSize,
            "sort": null,
            "userId": 1
          }
        };

        return JSON.stringify(json);
      },
      responseHandler:function(res){
        selectRW = res.data.rows[0];
        initQjTable();
        return res.data
      },
      queryParamsType : "undefined", // 参数格式,发送标准的RESTFul类型的参数请求
      silent : true, // 刷新事件必须设置
      onClickRow : function(row, $element) {
        $('.qj').val('');
        selectRW = row;
        $('#qjTable').bootstrapTable('destroy');
        initQjTable();
        $('.info').removeClass('info');
        $($element).addClass('info');
      },
      /*复选框设置*/
      onCheck:function(row){
        $('.rwDel').attr('disabled',false);
        delRWid[row.missionId] = 'true';
      },
      onUncheck:function(row){
        delete delRWid[row.missionId];
        if($.isEmptyObject(delRWid)){
          $('.rwDel').attr('disabled',true)
        }
      },
      onCheckAll:function(rows){
        $('.rwDel').attr('disabled',false);
        for(var i=0;i<rows.length;i++){
          delRWid[rows[i].missionId] = 'true';
        }
      },
      onUncheckAll:function(rows){
        delRWid = {};
        $('.rwDel').attr('disabled',true);
      },

      /*右键菜单*/
      contextMenu: '#RWcontext-menu',
      onContextMenuItem: function(row, $el){
        if($el.data("item") == "rename"){
          rename('rw',row.missionId);
        }
      }
    });
  }

  /*搜索事件*/
  function search(type){
    var params = $('#'+type+'Table').bootstrapTable('getOptions');
    params.queryParams = function(params) {
      var json;
      if(type == 'rw'){
        json = {
          "token": "",
          "data": {
            "missionName": params.searchText||'',
            "pageNum": 1,
            "pageSize": params.pageSize,
            "sort": null,
            "userId": 1
          }
        };
      }else{
        json = {
          "token": "",
          "data": {
            "missionId":selectRW.missionId,
            "scrnarinoName": params.searchText||'',
            "pageNum": params.pageNumber,
            "pageSize": params.pageSize,
            "sort": null,
            "userId": 1
          }
        };
      }
      json.data.missionName = $('.'+type).val();
      params = JSON.stringify(json);
      console.info(params);
      return params;
    };
    $('#'+type+'Table').bootstrapTable('refresh', params);
  }


  function initQjTable(){
    $('#qjTable').bootstrapTable({
      method : 'POST',
      url : 'qj.json',
      dataType : "json",
      contentType : "application/json", // 请求远程数据的内容类型。
      toobar:'#qjToolbar',
      iconSize : "outline",
      search:false,
      searchAlign:'right',
//      height:441,
      maintainSelected:true,
      clickToSelect : false,// 点击选中行
      pagination : false, // 在表格底部显示分页工具栏
      onlyInfoPagination:true,
      pageSize : 10, // 页面大小
      pageNumber : 1, // 页数
      pageList : [10],
      striped : false, // 使表格带有条纹
      sidePagination : "server",// 表格分页的位置 client||server
      rowStyle:function(row,index){
        return {
          classes: 'info'
        };
      },
      queryParams : function formPm(m){
        var json = {
          "token": "",
          "data": {
            "missionId":selectRW.missionId,
            "scrnarinoName": m.searchText||'',
            "pageNum": m.pageNumber,
            "pageSize": m.pageSize,
            "sort": null,
            "userId": 1
          }
        };

        return JSON.stringify(json);
      },
      responseHandler:function(res){
        return res.data
      },
      queryParamsType : "undefined", // 参数格式,发送标准的RESTFul类型的参数请求
      silent : true, // 刷新事件必须设置
      onClickRow : function(row, $element) {
        $('.success').addClass('info').removeClass('success');
        $($element).removeClass('info').addClass('success');
      },
      /*复选框设置*/
      onCheck:function(row){
        $('.qjDel').attr('disabled',false);
        delQJid[row.scenarinoId] = 'true';
      },
      onUncheck:function(row){
        delete delQJid[row.scenarinoId];
        if($.isEmptyObject(delQJid)){
          $('.qjDel').attr('disabled',true)
        }
      },
      onCheckAll:function(rows){
        $('.qjDel').attr('disabled',false);
        for(var i=0;i<rows.length;i++){
          delQJid[rows[i].scenarinoId] = 'true';
        }
      },
      onUncheckAll:function(rows){
        delQJid = {};
        $('.qjDel').attr('disabled',true);
      },

      /*右键菜单*/
      contextMenu: '#QJcontext-menu',
      onContextMenuItem: function(row, $el){
        if($el.data("item") == "rename"){
          rename('qj',row.scenarinoId);
        }
      }
    });
  }

  /*format 函数*/
  function rwName(v,row,i){
    return '<a href="#">'+ row.missionName +'</a><br><a style="font-size:12px; color:#a1a1a1;">创建时间：'+ row.addTime +'</a>'
  }

  function rwDomain(v,row,i){
    return row.missionDomain +'<br><a style="font-size:12px; color:#a1a1a1;">起止日期：'+ row.startDate+' - '+row.endDate +'</a>'
  }

  function qjName(v,row,i){
    return '<a href="#">'+ row.scenarinoName +'</a><br>'+
        '<a style="font-size:12px; color:#a1a1a1;">创建时间：'+ row.addTime +'</a><br/>'+
        '<a style="font-size:12px; color:#a1a1a1;">起止日期：'+ row.startDate+' - '+ row.endDate +'</a>'
  }

  function qjOrder(v,row,i){
    return '<button class="btn btn-primary mb10 mr10">启动</button>'+
        '<button class="btn btn-primary mb10">终止</button>'+
        '<br/>'+
        '<button class="btn btn-primary mr10">续跑</button>'+
        '<button class="btn btn-primary">暂停</button>'
  }

  function qjEffectEvaluation(v,row,i){
    return '<button class="btn btn-primary mb10 mr10">效果评估</button>'
  }


  /*delete 函数*/
  function deleteFun(type){
    var params = {userId:userId};
    var delList = [],url;
    if(type == 'rw'){
      for(var i in delRWid){
        delList.push(i);
      }
      params.missionIds = delList;
      url = '/mission/mission_delete';
    }else{
      for(var ii in delQJid){
        delList.push(ii);
      }
      params.scenarinoIds = delList;
      url = '/scenarino/scenarino_delete'
    }

    swal({
          title: "确定要删除?",
          type: "warning",
          showCancelButton: true,
          confirmButtonColor: "#DD6B55",
          confirmButtonText: "删除",
          cancelButtonText:"取消",
          closeOnConfirm: false
        },
        function(){

          ajaxPost(url,params).success(function(){
            if(type == 'rw'){
              $('#rwTable').bootstrapTable('destroy');
              initRwTable();
            }else{
              $('#qjTable').bootstrapTable('destroy');
              initQjTable();
            }
            swal("已删除!","", "success");
          }).error(function(){
            swal("删除失败!","", "error");
          })

        });

  }

  /*修改名称*/
  function rename(type,id){
    var url = 'rw.json';
    var params = {userId:userId};
    if(type == 'rw'){
      params.missionId = id;
    }else{
      params.scenarinoId = id;
    }

    swal({
          title: "名称修改",
//          text: "请输入新名称:",
          type: "input",
          showCancelButton: true,
          closeOnConfirm: false,
          confirmButtonText: "修改",
          cancelButtonText:"取消",
          animation: "slide-from-top",
          inputPlaceholder: "请输入新名称:"
        },
        function(inputValue){
          if (inputValue === false) return false;

          if (inputValue === "") {
            swal.showInputError("请输入内容!");
            return false
          }

          if(type == 'rw'){
            params.missionName = inputValue;
          }else{
            params.scenarinoName = inputValue;
          }

          ajaxPost(url,params).success(function(){
            if(type == 'rw'){
              $('#rwTable').bootstrapTable('destroy');
              initRwTable();
            }else{
              $('#qjTable').bootstrapTable('destroy');
              initQjTable();
            }
            swal("已修改!","修改名称为："+ inputValue, "success");
          }).error(function(){
            swal("修改失败!","名称未修改为："+ inputValue, "error");
          })

//          swal("Nice!", "You wrote: " + inputValue, "success");
        });

  }

</script>
</html>