<div class="easyui-layout" data-options="fit:true" id="rwglpanle">
  <div data-options="region:'north',border:false" style="height: 74px">


    <h1 style="margin-top: 8px;text-indent: 8px;border-left: 2px solid #88b7e0;font-size: 18px">
      任务列表</h1>
    <div class="cloudui" style="padding-top: 8px">
      <a href="javascript:void(0)" id="selectTypeBtn">全部</a>
      <div id="selectTypeMenu" style="width:160px">
        <ul>
          <li onclick="statusRWfun(this,'')" class="selected"><i class="fa fa-check"
                                                                 aria-hidden="true"></i><span>全部</span></li>
          <li onclick="statusRWfun(this,'2')"><i class="fa fa-check" aria-hidden="true"></i><span>预评估</span></li>
          <li onclick="statusRWfun(this,'3')"><i class="fa fa-check" aria-hidden="true"></i><span>后评估</span></li>
        </ul>
      </div>

      <div id="toolbar" style="float: right;">
        <a id="addnewqd" onclick='addRWWindow()'><i class="fa fa-plus"
                                                    aria-hidden="true"></i>&nbsp;创建任务</a>
        <a id="deleteqd" onclick="deleteFun()"><i class="fa fa-trash-o" aria-hidden="true"></i>&nbsp;删除</a>
        <input type="text" id="searchqd">
        <script>
          $('#addnewqd').linkbutton();
          $('#deleteqd').linkbutton();
          $('#searchqd').searchbox({prompt: '输入任务或情景名称'});
          $('#selectTypeBtn').menubutton({
            menu: '#selectTypeMenu',
          });
        </script>
      </div>
    </div>

  </div>
  <div data-options="region:'center',border:false">
    <div id="rwgltablebox">
      <table id="rwgltable">

      </table>
    </div>

  </div>
  <div data-options="region:'south',border:false">
    <div id="rwpagination"></div>
  </div>
</div>
<div id="addRW" class="easyui-window" tabindex="-1" role="dialog" style="display: none">
  <div class="step1">
    <button onclick="selectType('y')"><img src="img/ypg.png" alt=""></button>
    <button onclick="selectType('h')"><img src="img/hpg.png" alt=""></button>
  </div>
  <div class="step2 cloudui" style="display: none">
    <form style="padding: 20px 20px 0" class="rwForm" id="rwForm">
      <div class="form-group">
        <label class="col-2 control-label">任务名称</label>
        <div class="col-10">
          <input type="text" class="form-control" placeholder="任务名称" name="rwName" id="rwName">
        </div>
      </div>
      <div class="form-group">
        <label class="col-2 control-label">模拟范围</label>
        <div class="col-10">
          <select name="mnfw" id="mnfw" class="form-control" name="mnfw">
            <option value="1">范围1</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label class="col-2 control-label">清单</label>
        <div class="col-10">
          <select name="qd" id="qd" class="form-control">
            <option value="1">2015年河北省清单</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label class="col-2 control-label">日期范围</label>
        <div class="col-10">
          <input type="text" class="form-control" id="rwDate" name="rwStartDate" readonly placeholder="请选择日期···">
          <i class="glyphicon glyphicon-calendar fa fa-calendar" onclick="showRwDate()"
             style="cursor:pointer;position: absolute;font-size: 17px;right: 25px;top: 7px;"></i>
        </div>
        <div class="col-10 col-offset-2" style="display: none">
          <span class="rwDateTip" style="color: red">预评估任务结束日期不应小于当前日期</span>
        </div>
      </div>
    </form>
    <div class="dlogFooter">
      <button class="btn btn-success" onclick="createRw()">创建</button>
      <button class="btn btn-default" onclick="$('#addRW').window('close')">返回</button>
    </div>
  </div>
</div>
<div id="addYQJ" class="easyui-window" tabindex="-1" role="dialog" style="display: none">
  <div class="step1">
    <button onclick="selectQJtype('yy')" class="disYQJ"><img src="img/ypg.png" alt=""></button>
    <button onclick="selectQJtype('yh')" class="hQJbtn"><img src="img/hpg.png" alt=""></button>
  </div>
  <div class="step2 cloudui" style="display: none">
    <form style="padding: 20px 20px 0" class="yqjForm" id="yqjForm">
      <div class="form-group">
        <label class="col-2 control-label">情景名称</label>
        <div class="col-10">
          <input type="text" class="form-control" placeholder="情景名称" name="yName" id="yName">
        </div>
        <div class="col-10 col-offset-2">
          <span>（限15字以内）</span>
        </div>
      </div>
      <div class="form-group dbqj">
        <label class="col-2 control-label">
          <input style="position: absolute;left: -5px;top: 11px;" type="checkbox" class="chengeDB"
                 onchange="checkedDB(this)"/>
          对比情景
        </label>
        <div class="col-10">
          <select name="dbqj" id="dbqj" class="form-control hqj" disabled>
            <option value="1">1</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label class="col-2 control-label">基础情景</label>
        <div class="col-10">
          <select name="jcqj" id="jcqj" class="form-control yqj jcqj" onchange="changeJcqj(this)">
            <option value="1">1</option>
            <option value="2">2</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label class="col-2 control-label">基础日期</label>
        <div class="col-10">
          <select name="jcdate" id="jcdate" class="form-control yqj jcdate" onchange="changeJcDate(this)">
            <option value="1">1</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label class="col-2 control-label">开始日期</label>
        <div class="col-10">
          <select name="yStartDate" id="yStartDate" class="form-control" disabled>
            <option value="1">1</option>
          </select>
        </div>
        <div class="col-10 col-offset-2" style="display: none">
          <span class="rwDateTip" style="color: red">预评估任务结束日期不应小于当前日期</span>
        </div>
      </div>
      <div class="form-group">
        <label class="col-2 control-label">结束日期</label>
        <div class="col-10">
          <select name="yEndDate" id="yEndDate" class="form-control yqj">
            <option value="1">1</option>
          </select>
        </div>
      </div>
    </form>
    <div class="dlogFooter">
      <button class="btn btn-success" onclick="createQj('ypg')">创建</button>
      <button class="btn btn-default" onclick="$('#addYQJ').window('close')">返回</button>
    </div>
  </div>
</div>
<div id="addHQJ" class="easyui-window" tabindex="-1" role="dialog" style="display: none">
  <div class="step1">
    <button onclick="selectQJtype('hh')" class="cjhpgqj hQJbtn"><img src="img/hpg.png" alt=""></button>
    <button onclick="selectQJtype('hj')" class="cjxjzqj jzBtn"><img src="img/jz.png" alt=""></button>
  </div>
  <div class="step2 cloudui" style="display: none">
    <form style="padding: 20px 20px 0" class="hqjForm" id="hqjForm">
      <div class="form-group">
        <label for="hName" class="col-2 control-label">情景名称</label>

        <div class="col-10">
          <input type="text" class="form-control" id="hName" name="hName" placeholder="情景名称">
        </div>
        <div class="col-10 col-offset-2">
          <span>（限15字以内）</span>
        </div>
      </div>
      <div class="form-group spinup">
        <label for="spinup" class="col-2 control-label">spinup <br/> 天数</label>

        <div class="col-10">
          <select name="spinup" id="spinup" class="form-control">
            <option value="7">7</option>
            <option value="14">14</option>
            <option value="21">21</option>
            <option value="28">28</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label class="col-2 control-label">基础情景</label>
        <div class="col-10">
          <select name="jcqj" id="jcqj" class="form-control yqj jcqj" onchange="changeJcqj(this)">
            <option value="1">1</option>
            <option value="2">2</option>
          </select>
        </div>
      </div>
      <div class="diffNo">
        <div class="form-group dbqj1">
          <label for="dbqj1" class="col-2 control-label">
            <input style="position: absolute;left: -5px;top: 4px;" type="checkbox" class="chengeDB"
                   onchange="checkedDB(this)"/>
            对比情景
          </label>

          <div class="col-10">
            <select name="dbqj1" id="dbqj1" class="form-control hqj" disabled>
              <option value="1">1</option>
            </select>
          </div>
        </div>
        <div class="form-group ">
          <label for="jcqj1" class="col-2 control-label">基础情景</label>

          <div class="col-10">
            <select name="mnfw" id="jcqj1" class="form-control jcqj" onchange="changeJcqj1(this)">
              <option value="1">1</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label for="jcdate1" class="col-2 control-label">基础日期</label>

          <div class="col-10">
            <select name="jcdate1" id="jcdate1" class="form-control jcdate" onchange="changeJcDate1(this)">
              <option value="1">1</option>
            </select>
          </div>
        </div>
      </div>
      <div class="form-group ">
        <label for="hStartDate" class="col-2 control-label">开始日期</label>

        <div class="col-10">
          <select name="hStartDate" id="hStartDate" class="form-control" disabled>
            <option value="1">1</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label for="hEndDate" class="col-2 control-label">结束日期</label>

        <div class="col-10">
          <select name="hEndDate" id="hEndDate" class="form-control">
            <option value="1">1</option>
          </select>
        </div>
      </div>
    </form>
    <div class="dlogFooter">
      <button class="btn btn-success" onclick="createQj('ypg')">创建</button>
      <button class="btn btn-default" onclick="$('#addHQJ').window('close')">返回</button>
    </div>
  </div>
</div>
<script>
  var transformdata = [];
  var subBtn = true;
  var rwSelectType = '';
  var statusRW = '';
  var selectRW = {};
  var basisArr, qjType;
  var qjType = 0;
  var __dsp = {};//用于存储请求信息，做Promise存储
  (function () {
    /*新增情景的事件绑定*/
//    $('#rwgltablebox').on("click",'[field=missionEndDate]>div>a',function (e) {
//      e.stopPropagation();
//      e.preventDefault();
//      createQJselect($(this).attr('data-missionId'));
//      console.log($(this).attr('data-missionId'));
//    })
    /*修改面包屑中的显示内容*/
    $("#crumb").html('<a href="#/rwgl" style="padding-left: 15px;padding-right: 15px;">任务管理</a>');
    /*生成页面底部的分页器*/
    $('#rwpagination').pagination({
      total: 33,
      pageSize: 10,
      showPageList:false,
      onSelectPage:function(pageNumber, pageSize){
        $.ajax({
          url: '/ampc/mission/get_mission_list',
          contentType: 'application/json',
          method: 'post',
          dataType: 'JSON',
          data: JSON.stringify({
            "token": "",
            "data": {
              "queryName": '',
              "missionStatus": '',
              "pageNum": pageNumber,
              "pageSize": 10,
              "sort": '',
              "userId": 1
            }
          }),
          success: function (data) {
//            transformdat=[];
            requestQJData(data.data);
            console.log(transformdata);
            $('#rwgltable').treegrid({data: transformdata});
          }
        });
      }
    });
    /*生成相关创建任务的模态框*/
    $("#addRW").window({
      width: 600,
      collapsible: false,
      maximizable: false,
      minimizable: false,
      modal: true,
      shadow: false,
      title: '新增任务',
      border: false,
      closed: true,
      cls: 'cloudui'
    });
    /*生成相关创建情景的模态框*/
    $("#addYQJ").window({
      width: 600,
      collapsible: false,
      maximizable: false,
      minimizable: false,
      modal: true,
      shadow: false,
      title: '新增情景',
      border: false,
      closed: true,
      cls: 'cloudui'
    });
    $("#addHQJ").window({
      width: 600,
      collapsible: false,
      maximizable: false,
      minimizable: false,
      modal: true,
      shadow: false,
      title: '新增情景',
      border: false,
      closed: true,
      cls: 'cloudui'
    });
    /*页面中间的任务列表部分的滚动条*/
    $("#rwgltablebox").slimScroll({
      height: '100%'
    });
    /*事件绑定*/
    /*任务列表中设置的下拉框*/
    $("#rwgltablebox").on('click', '.dropdownmenu>a', function (e) {
      $(this).siblings().show();
    });
    $("#rwgltablebox").on('mouseleave', '.dropdownmenu', function (e) {
      $(this).find('ul').hide();
    });

    $('#rwglpanle').layout();
    $.ajax({
      url: localhttp + '/ampc/mission/get_mission_list',
      contentType: 'application/json',
      method: 'post',
      dataType: 'JSON',
      data: JSON.stringify({
        "token": "",
        "data": {
          "queryName": '',
          "missionStatus": '',
          "pageNum": 1,
          "pageSize": 10,
          "sort": '',
          "userId": 1
        }
      }),
      success: function (data) {
        requestQJData(data.data);
        console.log(transformdata);
        $('#rwgltable').treegrid({
          data: transformdata,
          idField: 'id',
          showHeader: false,
          checkbox: true,
          animate: true,
          border: false,
          checkOnSelect: false,
          fitColumns: true,
          treeField: 'missionName',
          columns: [[{
            field: 'missionName', title: '任务名称', formatter: missionNameFormatter, width: 200
          }, {
            field: 'missionId', title: 'ID', formatter: missionIdFormatter, width: 80
          }, {
            field: 'domainName', title: '模拟范围', formatter: domainNameFormatter, width: 200
          }, {
            field: 'esCouplingName', title: '清单', width: 200, formatter: esCouplingNameFormatter
          }, {
            field: 'missionAddTime', title: '创建时间', width: 250, formatter: missionAddTimeFormatter
          }, {
            field: 'missionStartDate', title: '开始日期', width: 250, formatter: missionDateFormatter
          }, {
            field: 'missionStatus', title: '类型', width: 90, formatter: missionStatusFormatter
          }, {
            field: 'missionEndDate', title: '操作', width: 80, formatter: missionmanage
          }]],
          onClickRow: function (row) {
            console.log(arguments);
            console.log(this);
            if (typeof row.children === 'undefined') {
              return
            }
            if ($('[node-id="' + row.id + '"]').hasClass('datagrid-row-clicked')) {
              $('[node-id="' + row.id + '"]').removeClass('datagrid-row-clicked');
              $('#rwgltable').treegrid('toggle', row.id);
            } else {
              $('[node-id="' + row.id + '"]').addClass('datagrid-row-clicked').siblings().removeClass('datagrid-row-clicked');
              $('#rwgltable').treegrid('collapseAll').treegrid('expand', row.id);
            }

          }
        });
        $('#rwpagination').pagination({total:data.data.total});
      }
    });
//    启动表单验证
    formVerify();
  })();

  function requestQJData(res) {
    transformdata=[];
    for (var i = 0; i < res.rows.length; i++) {
      transformdata.push($.extend({}, res.rows[i], {id: 'rw' + res.rows[i].missionId, state: 'closed'}));
      $.ajax({
        url: '/ampc/scenarino/get_scenarinoListBymissionId',
        contentType: 'application/json',
        method: 'post',
        async: false,
        dataType: 'JSON',
        data: JSON.stringify({
          "token": "",
          "data": {
            "missionId": res.rows[i].missionId,
            "queryName": '',
            "sort": '',
            "userId": 1
          }
        }),
        success: function (data) {
//          if(data.data.rows.length==0){
//            return;
//          }
          console.log(data);
          transformdata[transformdata.length - 1].children = [];
          transformdata[transformdata.length - 1].children.push($.extend({}, {
            missionNameTitle: '情景名称', missionIdTitle: 'ID', domainNameTitle: '操作', esCouplingNameTitle: '管理',
            missionAddTimeTitle: '情景状态', missionStartDateTitle: '执行日期', missionEndDateTitle: '结束日期',
            missionStatusTitle: '类型'
          }, {id: 'qjtitle' + res.rows[i].missionId}))
          for (var j = 0; j < data.data.rows.length; j++) {
            transformdata[transformdata.length - 1].children.push($.extend({}, data.data.rows[j], {id: 'qj' + data.data.rows[j].scenarinoId}));
          }
        }
      });
    }
  }
  function missionNameFormatter(value, row, index) {
    if (typeof row.missionName === 'undefined') {
      if (typeof row.missionNameTitle === 'undefined') {
        return row.scenarinoName;
      }
      return row.missionNameTitle;
    }
    return row.missionName
  }
  function missionIdFormatter(value, row, index) {
    if (typeof row.missionId === 'undefined') {
      if (typeof row.missionIdTitle === 'undefined') {
        return row.scenarinoId;
      }
      return row.missionIdTitle;
    }
    return 'No:' + row.missionId
  }
  function domainNameFormatter(value, row, index) {
    if (typeof row.domainName === 'undefined') {
      if (typeof row.domainNameTitle === 'undefined') {
        if (row.scenarinoStatus == 5) {
          return "<a href='javascript:' onclick='startBtn()' style='color: #9CC8F7'><i class='im-play2'> 启动</i></a>";
        } else if (row.scenarinoStatus == 6) {
          return "<a href='javascript:' style='color: #9CC8F7'><i class='im-pause'> 暂停</i></a>";
        } else if (row.scenarinoStatus == 7) {
          return "<a href='javascript:' style='color: #9CC8F7'><i class='im-play2'> 续跑</i></a>";
        }
      }
      return row.domainNameTitle;
    }
    return '<div class="rwdetail">模拟范围：' + row.domainName + '</div>'
  }
  function esCouplingNameFormatter(value, row, index) {
    if (typeof row.esCouplingName === 'undefined') {
      if (typeof row.esCouplingNameTitle === 'undefined') {
        if (row.scenarinoStatus == 6 || row.scenarinoStatus == 7) {
          return "<a href='javascript:' style='color: #9CC8F7'><i class='im-stop'> 终止</i></a>"
        } else {
          return "<i class='im-stop'style='color: #ccc'> 终止</i>";
        }
      }
      return row.esCouplingNameTitle;
    }
    return '<div class="rwdetail">' + row.esCouplingName + '</div>'
  }
  function missionAddTimeFormatter(value, row, index) {
    if (typeof row.missionAddTime === 'undefined') {
      if (typeof row.missionAddTimeTitle === 'undefined') {
        if (row.scenarinoStatus == 3 || row.scenarinoStatus == 6) {
          return '<a href="javascript:" class="statusType">' + row.scenarinoStatuName + '</a>'
        } else {
          return row.scenarinoStatuName
        }
      }
      return row.missionAddTimeTitle;
    }
    return '<div class="rwdetail">创建于&nbsp;' + moment(row.missionAddTime).format('YYYY-M-D H:MM:ss') + '</div>';
  }
  function missionDateFormatter(value, row, index) {
    if (typeof row.missionStartDate === 'undefined') {
      if (typeof row.missionStartDateTitle === 'undefined') {
        return moment(row.scenarinoStartDate).format('YYYY-MM-DD') + '&nbsp;--&nbsp;' + moment(row.scenarinoEndDate).format('YYYY-MM-DD');
      }
      return row.missionStartDateTitle;
    }
    return '<div class="missionstatus"><div class="rwdetail">' + moment(row.missionStartDate).format('YYYY-M-D') + '&nbsp;--&nbsp;' + moment(row.missionEndDate).format('YYYY-M-D') + '</div></div><div class="missiondetail">情景：n，正在执行：m</div>';
  }
  //  function missionStartDateFormatter(value, row, index) {
  //    if (typeof row.missionStartDate=== 'undefined') {
  //      if(typeof row.missionStartDateTitle ==='undefined'){
  //        return moment(row.scenarinoStartDate).format('YYYY-MM-DD');
  //      }
  //      return row.missionStartDateTitle;
  //    }
  //    return '<div class="rwdetail">模拟从&nbsp;'+moment(row.missionStartDate).format('YYYY-M-D')+'</div>';
  //  }
  //  function missionEndDateFormatter(value, row, index) {
  //    if (typeof row.missionEndDate=== 'undefined') {
  //      if(typeof row.missionEndDateTitle ==='undefined'){
  //        return moment(row.scenarinoEndDate).format('YYYY-MM-DD');
  //      }
  //      return row.missionEndDateTitle;
  //    }
  //    return '<div class="rwdetail">到&nbsp;'+moment(row.missionEndDate).format('YYYY-M-D')+'</div>';
  //  }
  function missionStatusFormatter(value, row, index) {
    if (typeof row.missionStatus === 'undefined') {
      if (typeof row.missionStatusTitle === 'undefined') {
        var type;
        switch (row.SCEN_TYPE) {
          case '1':
            type = '预评估情景';
            break;
          case '2':
            type = '后评估情景';
            break;
          case '3':
            type = '新基准情景';
            break;
        }
        return type
      }
      return row.missionStatusTitle;
    }
    var type;
    switch (row.missionStatus) {
      case '2':
        type = '预评估';
        break;
      case '3':
        type = '后评估';
        break;
    }
    return type;
//    return '<div class="missionstatus">' + type + '</div><div class="missiondetail">情景：n，正在执行：m</div>'
  }
  function missionmanage(value, row, index) {
    if (typeof row.missionStatus === 'undefined') {
      if (typeof row.missionStatusTitle === 'undefined') {
        return '<div class="dropdownmenu"><a href="javascript:"><i class="fa fa-caret-down" aria-hidden="true"></i></a><ul style="display: none"><li><a href="javascript:">修改情景名</a></li><li><a href="javascript:">删除</a></li></ul></div>'
      }
      return '设置'
    }
//    return '<a href="#"><i class="fa fa-plus" aria-hidden="true" style="color: #000"></i></a>'
    return '<a href="javascript:console.log(1)" onclick="stop(this)" data-missionId="' + row.id + '" style="font-size: 12px">[新增]</a>'
  }
  function stop(t) {
    var e = e || window.event;
    console.log(e);
    e.stopPropagation();
    createQJselect($(t).attr('data-missionId'));
  }
  /*初始化日期插件*/
  function initRwDate(s, e, start, end) {
    $('#rwDate').daterangepicker({
      singleDatePicker: false,  //显示单个日历
      timePicker: false,  //允许选择时间
      timePicker24Hour: true, //时间24小时制
      minDate: s,//最早可选日期
      maxDate: e,//最大可选日期
      locale: {
        format: "YYYY-MM-DD",
        separator: " 至 ",
        applyLabel: "确定", //按钮文字
        cancelLabel: "取消",//按钮文字
        weekLabel: "W",
        daysOfWeek: [
          "日", "一", "二", "三", "四", "五", "六"
        ],
        monthNames: [
          "一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"
        ],
        firstDay: 1
      },
      "startDate": start,
      "endDate": end,
      "opens": "right"
    }, function (start, end, label) {
      rwStartDate = start.format('YYYY-MM-DD');
      rwEndDate = end.format('YYYY-MM-DD');
    })
    var d = $('#rwDate').data('daterangepicker');
    d.element.off();
  }
  /*按钮打开日期*/
  function showRwDate() {
    var d = $('#rwDate').data('daterangepicker');
    d.toggle();
  }
  /*创建任务选择预评估或后评估*/
  function selectType(type) {
    rwTypeV = type;
    var startDate;
    var endDate;
    var start, end;
    if (type == 'y') {
      startDate = moment().subtract(14, 'd').format('YYYY-MM-DD');
      endDate = moment().add(365, 'd').format('YYYY-MM-DD');
      start = moment().subtract(2, 'd').format('YYYY-MM-DD');
      end = moment().add(14, 'd').format('YYYY-MM-DD');
      rwSelectType = '2';
//      $('.rwTitle').html('创建预评估任务');
      $("#addRW").panel({title: '创建预评估任务'});
      //rwEndDate = moment().add(2, 'd').format('YYYY-MM-DD');
      initRwDate(startDate, endDate, start, end);
    } else if (type == 'h') {
      startDate = '2007-01-01';
      endDate = moment().subtract(2, 'd').format('YYYY-MM-DD');
      start = moment().subtract(32, 'd').format('YYYY-MM-DD');
      end = moment().subtract(2, 'd').format('YYYY-MM-DD');
      rwSelectType = '3';
      $("#addRW").panel({title: '创建后估任务'});
      //rwEndDate = moment().subtract(2, 'd').format('YYYY-MM-DD');
      initRwDate(startDate, endDate, start, end);
    }

    $('#addRW .step1').css('display', 'none');
    $('#addRW .step2').css('display', 'block');
    $("#addRW").window("center");
//    $('.createRwBtn').css('display', 'inline-block');
//    $('.return_S_rw').css('display', 'inline-block');
    //rwStartDate = moment().subtract(2, 'w').format('YYYY-MM-DD');
    rwStartDate = start;
    rwEndDate = end;
  }
  /*创建任务的window方法*/
  function addRWWindow() {
    $("#addRW").window("open").window('center');
    $('#addRW .step1').css('display', 'flex').siblings().css('display', 'none');
  }
  /*新改任务创建*/
  function createRw() {
    if ($('#rwForm').valid()) {
      if (!subBtn)return;
      subBtn = false;
      var url = '/ampc/mission/save_mission';
      var urlName = '/ampc/mission/check_missioname';
      var params = {};
      var paramsName = {};
      params.missionName = paramsName.missionName = $('#rwName').val();
      params.missionDomainId = $('#mnfw').val();
      params.esCouplingId = $('#qd').val();
      params.missionStartDate = moment(selectRW.missionStartDate).format('YYYY-MM-DD HH:mm:ss');
      params.missionEndDate = moment(selectRW.missionEndDate).add(1, 'd').subtract(1, 's').format('YYYY-MM-DD HH:mm:ss');
      params.userId = paramsName.userId = userId;
      params.missionStauts = rwSelectType;
      if (rwSelectType == '2') {
        if (rwEndDate < moment().format('YYYY-MM-DD')) {
          $('.rwDateTip').show();
          return;
        } else {
          $('.rwDateTip').hide();
        }
      }

      ajaxPost(urlName, paramsName).success(function (res) {
        if (res.data) {
          ajaxPost(url, params).success(function (res) {
            if (res.status == 0) {
              $("#addRW").window("close");
              reloadTreegrid();
              $('#rwName').val('');
              swal({
                title: '添加成功!',
                type: 'success',
                timer: 1000,
                showConfirmButton: false
              });
              $('#rwName').val('')
            } else {
              $("#addRW").window("close");
              swal({
                title: '添加失败!',
                type: 'error',
                timer: 1000,
                showConfirmButton: false
              });
            }
          }).error(function () {

            $('#createRwModal').modal('hide');
            swal({
              title: '添加失败!',
              type: 'error',
              timer: 1000,
              showConfirmButton: false
            });
            //swal('添加失败', '', 'error')
          })
        } else {
          swal({
            title: '名称重复!',
            type: 'error',
            timer: 1000,
            showConfirmButton: false
          });
          //swal('名称重复', '', 'error')
          subBtn = true;
        }
      }).error(function () {
        console.log(arguments);
        swal({
          title: '校验失败!',
          type: 'error',
          timer: 1000,
          showConfirmButton: false
        });
        //swal('校验失败', '', 'error')
        subBtn = true;
      })
    }

  }
  //  表单验证有关函数
  function formVerify() {

    $.validator.addMethod("dateV", function (value, element) {
      var startD = value.substring(0, value.indexOf('至'));
      var endD = value.substring(value.indexOf('至') + 1);

      if (rwTypeV == 'y') {
        var s = moment(startD).isBefore(moment().add(-1, 'd'));
        var e = moment(endD).isAfter(moment());
        return s && e;
      } else {
        return true
      }
    }, "请输入正确日期范围");


    $("#rwForm").validate({
      debug: true,
      rules: {
        rwName: {
          required: true,
          maxlength: 15
        },
        rwStartDate: {
          required: true,
          dateV: true
        },
      },
      messages: {
        rwName: {
          required: '请填写任务名称',
          maxlength: '不可超过15个字符'
        },
        rwStartDate: {
          required: '请填写日期'
        },
      }

    });

    $("#yqjForm").validate({
      debug: true,
      rules: {
        yName: {
          required: true,
          maxlength: 15
        }
      },
      messages: {
        yName: {
          required: '请填写情景名称',
          maxlength: '不可超过15个字符'
        }
      }

    });

    $("#hqjForm").validate({
      debug: true,
      rules: {
        hName: {
          required: true,
          maxlength: 15
        }
      },
      messages: {
        hName: {
          required: '请填写情景名称',
          maxlength: '不可超过15个字符'
        }
      }

    });
  }
  /*刷新datagrid的数据*/
  function reloadTreegrid() {
    $.ajax({
      url: localhttp + '/ampc/mission/get_mission_list',
      contentType: 'application/json',
      method: 'post',
      dataType: 'JSON',
      data: JSON.stringify({
        "token": "",
        "data": {
          "queryName": '',
          "missionStatus": '',
          "pageNum": 1,
          "pageSize": 10,
          "sort": '',
          "userId": 1
        }
      }),
      success: function (data) {
        transformdata = [];
        requestQJData(data.data);
        console.log(transformdata);
        $('#rwgltable').treegrid({data: transformdata});
      }
    });
  }
  /*delete 函数*/
  function deleteFun(type) {
    var params = {userId: userId};
    var params1 = {userId: userId};
    var delList = '', url;
    var delRWid = {}, delQJid = {};
    var data = $('#rwgltable').treegrid('options').data;
    for (var i = 0; i < data.length; i++) {
      if (data[i].checkState == 'checked') {
        delRWid[data[i].missionId] = true;
      } else if (data[i].checkState == 'indeterminate') {
        for (var j = 1; j < data[i].children.length; j++) {
          if (data[i].children[j].checkState == "checked") {
            delQJid[data[i].children[j].scenarinoId] = true;
          }
        }
      }
    }
    console.log(delQJid);
//    if (type == 'rw') {
    for (var i in delRWid) {
      delList += i + ',';
    }
    delList = delList.substr(0, delList.length - 1);
    params.missionIds = delList;
    url = '/ampc/mission/delete_mission';
//    } else {
    delList = '';
    for (var ii in delQJid) {
      delList += ii + ',';
    }
    delList = delList.substr(0, delList.length - 1);
    params1.scenarinoIds = delList;
    url1 = '/ampc/scenarino/delete_scenarino'
//    }

    swal({
      title: "确定要删除?",
      type: "warning",
      showCancelButton: true,
      confirmButtonColor: "#DD6B55",
      confirmButtonText: "删除",
      cancelButtonText: "取消",
      closeOnConfirm: false
    }, function () {


      $.when(ajaxPost(url, params), ajaxPost(url1, params1))
        .done(function () {
          swal({
            title: '已删除!',
            type: 'success',
            timer: 1000,
            showConfirmButton: false
          });
          reloadTreegrid();
        })
        .fail(function () {
          swal({
            title: '删除失败!',
            type: 'error',
            timer: 1000,
            showConfirmButton: false
          });
        });
    })
  }

  /*筛选*/
  function statusRWfun(t, status) {
    $(t).addClass('selected').siblings().removeClass('selected');
    console.log($(this).find('span'));
    $("#selectTypeBtn").find('.l-btn-text').html($(t).find('span').html());
    statusRW = status;
    search('rw');
  }
  /*搜索事件*/
  function search(type) {
    var queryName = '',
      pageNum = 1,
      pageSize = 10,
      sort = '';
    ajaxPost('/ampc/mission/get_mission_list', {
      queryName: queryName, pageNum: pageNum, pageSize: pageSize, missionStatus: statusRW, sort: sort, userId: userId
    })
      .success(function (data) {
        transformdata = [];
        requestQJData(data.data);
        console.log(transformdata);
        $('#rwgltable').treegrid({data: transformdata});
      })
  }


  /*创建情景时选择模态框*/
  function createQJselect(id) {
    var oldQJUrl = '/ampc/scenarino/find_scenarino_time';
    //var oldQJUrl = 'date.json';
    var row = $('#rwgltable').treegrid('find', id);
    selectRW = $.extend({}, row);
    console.log(selectRW);
    var oldQJparams = {
      userId: userId,
      missionId: row.missionId
    };
    //if((!__dsp['jcqj'+selectRW.missionId]) || (basisArr.length ==0)){
    __dsp['jcqj' + row.missionId] = ajaxPost(oldQJUrl, oldQJparams);
    //}

    if (row.missionStatus == "2") {
      if (moment(row.missionEndDate).isBefore(moment(), 'day')) {
        $('.disYQJ').attr('disabled', true);
      } else {
        $('.disYQJ').removeAttr('disabled');
      }
      $("#addYQJ").window('open');
      $("#addYQJ .step1").show().siblings().hide();
      $("#addYQJ").window("center");
    } else if (selectRW.missionStatus == "3") {
//      $('#createHpQjModal h4.modal-title').html('创建情景');
      __dsp['jcqj' + row.missionId].success(function (res) {
        if (res.status == 0) {
          if (res.data.length == 0) {
            $('.cjhpgqj').eq(0).attr('disabled', true);
            $('.cjxjzqj').eq(0).removeAttr('disabled');
          } else if (res.data[0].ScenType == '3') {
            $('.cjxjzqj').eq(0).attr('disabled', true);
            $('.cjhpgqj').eq(0).removeAttr('disabled');
          } else {
            $('.cjhpgqj').eq(0).removeAttr('disabled');
            $('.cjxjzqj').eq(0).removeAttr('disabled');
          }
        } else {
          $('.cjhpgqj').eq(0).attr('disabled', true);
          $('.cjxjzqj').eq(0).removeAttr('disabled');
        }
      })
//      $('#createHpQjModal').modal('show');
      $("#addHQJ").window('open');
      $("#addHQJ .step1").show().siblings().hide();
      $("#addHQJ").window("center");
//      returnLeft('hqj');
    }
  }
  /*创建情景选择类型*/
  function selectQJtype(type) {

    var url = '/ampc/scenarino/find_endTime';
    //var url = 'end.json';
    var params = {
      userId: userId
    };

    __dsp['jcqj' + selectRW.missionId].then(function (res) {
      basisArr = res.data;
      if ((type == 'hj') && !basisArr) {
//        $('.hpgQJType').css('display', 'none');
//        $('.hpgQJCon').css('display', 'block');
//        $('.createQjBtn').css('display', 'inline-block');
//        $('.return_S_qj').css('display', 'inline-block');
        $('.diffNo').css('display', 'none');
        $('.spinup').css('display', 'block');
        $('#hEndDate').attr('disabled', true);
        qjType = 3;
        $('#hStartDate').empty().append($('<option value="' + moment(selectRW.missionStartDate).format('YYYY-MM-DD') + '">' + moment(selectRW.missionStartDate).format('YYYY-MM-DD') + '</option>'));
        $('#hEndDate').empty().append($('<option value="' + moment(selectRW.missionEndDate).format('YYYY-MM-DD') + '">' + moment(selectRW.missionEndDate).format('YYYY-MM-DD') + '</option>'));
      }
      if (basisArr) {

        //reverse  倒序
        switch (type) {
          case 'yy':
            $("#addYQJ").panel({title: '创建情景（预评估情景）'});
            $("#addYQJ .step1").hide().siblings().show();
            $("#addYQJ").window("center");
            $('.dbqj').css('display', 'none');
            qjType = 1;
            params.scenType = qjType;

            setOption('#jcqj', basisArr);
            var dateArr = setSelectDate(basisArr[0].scenarinoStartDate, basisArr[0].scenarinoEndDate, !(basisArr[0].pathDate) ? moment().add(-1, 'd') : basisArr[0].pathDate);
            $('#jcdate').empty();
            for (var i = 0; i < dateArr.length; i++) {
              $('#jcdate').append($('<option value="' + dateArr[i] + '">' + dateArr[i] + '</option>'))
            }
            var startD = dateArr[0] ? moment(moment(dateArr[0])).add(1, 'd').format('YYYY-MM-DD') : '';
            $('#yStartDate').empty().append($('<option value="' + startD + '">' + startD + '</option>'));
            console.log(1);
            ajaxPost(url, params).success(function (res) {
              console.log(res);
              selectEndDate = res.data.endTime;
              selectEndDate = moment(selectRW.missionEndDate).add(1, 'd').isBefore(selectEndDate) ? moment(selectRW.missionEndDate).format('YYYY-MM-DD') : selectEndDate;
              if ($('#yStartDate').val() == '') {
                $('#yEndDate').empty();
                return;
              }
              var endDateArr = setSelectDate($('#yStartDate').val(), selectEndDate);
              $('#yEndDate').empty();
              for (var i = 0; i < endDateArr.length; i++) {
                if (endDateArr[i] < moment().format('YYYY-MM-DD'))continue;
                $('#yEndDate').append($('<option value="' + endDateArr[i] + '">' + endDateArr[i] + '</option>'))
              }
              console.log(2);
            }).fail(function () {
              console.log(arguments);
            });

            break;
          case 'yh':
            $("#addYQJ").panel({title: '创建情景（后评估情景）'});
            $("#addYQJ .step1").hide().siblings().show();
            $("#addYQJ").window("center");
//            $('#createYpQjModal h4.modal-title').html('创建情景（后评估情景）');
//            $('.ypgQJType').css('display', 'none');
//            $('.ypgQJCon').css('display', 'block');
            $('.dbqj').css('display', 'block');
//            $('.createQjBtn').css('display', 'inline-block');
//            $('.return_S_qj').css('display', 'inline-block');
            $('#dbqj').attr('disabled', true);
            $('#jcqj').removeAttr('disabled');
            $('#jcdate').removeAttr('disabled');
            $('#yEndDate').removeAttr('disabled');
            qjType = 2;
            params.scenType = qjType;

            if (basisArr.length <= 1) {
              $('.chengeDB').attr('disabled', true)
            } else {
              $('.chengeDB').removeAttr('disabled')
            }
            setOption('#dbqj', basisArr);
            setOption('#jcqj', basisArr);

            var dateArr = setSelectDate(basisArr[0].scenarinoStartDate, basisArr[0].scenarinoEndDate, basisArr[0].pathDate);
            dateArr = dateArr.reverse();
            $('#jcdate').empty();
            for (var i = 0; i < dateArr.length; i++) {
              $('#jcdate').append($('<option value="' + dateArr[i] + '">' + dateArr[i] + '</option>'))
            }
            var startD = moment(moment(dateArr[0])).add(1, 'd').format('YYYY-MM-DD');
            $('#yStartDate').empty().append($('<option value="' + startD + '">' + startD + '</option>'));

            ajaxPost(url, params).success(function (res) {
              selectEndDate = res.data.endTime;
              selectEndDate = moment(selectRW.missionEndDate).add(1, 'd').isBefore(selectEndDate) ? moment(selectRW.missionEndDate).format('YYYY-MM-DD') : selectEndDate;
              var endDateArr = setSelectDate($('#yStartDate').val(), selectEndDate);
              $('#yEndDate').empty();
              for (var i = 0; i < endDateArr.length; i++) {
                if (endDateArr[i] < moment(startD).format('YYYY-MM-DD'))continue;
                $('#yEndDate').append($('<option value="' + endDateArr[i] + '">' + endDateArr[i] + '</option>'))
              }
            });


            break;
          case 'hh':
            $('#createHpQjModal h4.modal-title').html('创建情景（后评估情景）');
//            $('.hpgQJType').css('display', 'none');
//            $('.hpgQJCon').css('display', 'block');
//            $('.createQjBtn').css('display', 'inline-block');
//            $('.return_S_qj').css('display', 'inline-block');
            $("#addHQJ").panel({title: '创建情景（后评估情景）'});
            $("#addHQJ .step1").hide().siblings().show();
            $("#addHQJ").window("center");
            $('.diffNo').css('display', 'block');
            $('.spinup').css('display', 'none');
            $('#dbqj1').attr('disabled', true);
            $('#jcqj1').removeAttr('disabled');
            $('#jcdate1').removeAttr('disabled');
            $('#hEndDate').removeAttr('disabled');
            qjType = 2;

            if (basisArr.length <= 1) {
              $('.chengeDB').attr('disabled', true)
            } else {
              $('.chengeDB').removeAttr('disabled')
            }
            setOption('#dbqj1', basisArr);
            setOption('#jcqj1', basisArr);
            var dateArr = setSelectDate(basisArr[0].scenarinoStartDate, moment(selectRW.missionEndDate).subtract(1, 'd').format('YYYY-MM-DD'));
            dateArr = dateArr.reverse();
            $('#jcdate1').empty();
            for (var i = 0; i < dateArr.length; i++) {
              $('#jcdate1').append($('<option value="' + dateArr[i] + '">' + dateArr[i] + '</option>'))
            }
            var startD = moment(moment(dateArr[0])).add(1, 'd').format('YYYY-MM-DD');
            $('#hStartDate').empty().append($('<option value="' + startD + '">' + startD + '</option>'));


            var endDateArr = setSelectDate($('#hStartDate').val(), moment(selectRW.missionEndDate));
            $('#hEndDate').empty();
            for (var i = 0; i < endDateArr.length; i++) {
              $('#hEndDate').append($('<option value="' + endDateArr[i] + '">' + endDateArr[i] + '</option>'))
            }
            break;
          case 'hj':
            $('#createHpQjModal h4.modal-title').html('创建情景（新基准情景）');
//            $('.hpgQJType').css('display', 'none');
//            $('.hpgQJCon').css('display', 'block');
//            $('.createQjBtn').css('display', 'inline-block');
//            $('.return_S_qj').css('display', 'inline-block');
            $('.diffNo').css('display', 'none');
            $('.spinup').css('display', 'block');
            $('#hEndDate').attr('disabled', true);
            qjType = 3;
            $('#hStartDate').empty().append($('<option value="' + moment(selectRW.missionStartDate).format('YYYY-MM-DD') + '">' + moment(selectRW.missionStartDate).format('YYYY-MM-DD') + '</option>'));
            $('#hEndDate').empty().append($('<option value="' + moment(selectRW.missionEndDate).format('YYYY-MM-DD') + '">' + moment(selectRW.missionEndDate).format('YYYY-MM-DD') + '</option>'));
            break;
        }
      } else {
        if (type != 'hj') {
          swal({
            title: res.msg,
            type: 'error',
            timer: 1000,
            showConfirmButton: false
          });
        }
      }
    }, function () {
      console.log('基础情景获取失败！！！！！');
      if (type == 'hj') {
//        $('.hpgQJType').css('display', 'none');
//        $('.hpgQJCon').css('display', 'block');
//        $('.createQjBtn').css('display', 'inline-block');
//        $('.return_S_qj').css('display', 'inline-block');
        $('.diffNo').css('display', 'none');
        $('.spinup').css('display', 'block');
        $('#hEndDate').attr('disabled', true);
        qjType = 3;
        $('#hStartDate').empty().append($('<option value="' + moment(selectRW.missionStartDate).format('YYYY-MM-DD') + '">' + moment(selectRW.missionStartDate).format('YYYY-MM-DD') + '</option>'));
        $('#hEndDate').empty().append($('<option value="' + moment(selectRW.missionEndDate).format('YYYY-MM-DD') + '">' + moment(selectRW.missionEndDate).format('YYYY-MM-DD') + '</option>'));
      }
    })
  }
  /*配置日期*/
  function setSelectDate(qjS, qjE, pathD) {
    var dateArr = [];
    if (pathD) {
      var p = moment(pathD);
      //while (!(p.isBefore(moment(qjS),'d'))) {
      while (!p.isBefore(moment(qjS), 'd')) {
        dateArr.push(p.subtract(1, 'd').format('YYYY-MM-DD'));
      }
    } else {
      var e = moment(qjE);
      while (!(e.isBefore(moment(qjS), 'd'))) {
        dateArr.push(e.format('YYYY-MM-DD'));
        e.subtract(1, 'd');
      }
    }
    return dateArr
  }
  /*添加option*/
  function setOption(ele, res) {
    $(ele).empty();
    for (var i = 0; i < res.length; i++) {
      if (((ele == '#dbqj') || (ele == '#dbqj1')) && (res[i].scenarinoId == -1))continue;
      $(ele).append($('<option value="' + i + '">' + res[i].scenarinoName + '</option>'))
    }
  }

  function checkedDB(t) {
    if ($(t)[0].checked) {
      $('#dbqj').removeAttr('disabled');
      $('#jcqj').attr('disabled', true);
      $('#jcdate').attr('disabled', true);
      $('#yEndDate').attr('disabled', true);

      $('#dbqj1').removeAttr('disabled');
      $('#jcqj1').attr('disabled', true);
      $('#jcdate1').attr('disabled', true);
      $('#hEndDate').attr('disabled', true);
    } else {
      $('#dbqj').attr('disabled', true);
      $('#jcqj').removeAttr('disabled');
      $('#jcdate').removeAttr('disabled');
      $('#yEndDate').removeAttr('disabled');

      $('#dbqj1').attr('disabled', true);
      $('#jcqj1').removeAttr('disabled');
      $('#jcdate1').removeAttr('disabled');
      $('#hEndDate').removeAttr('disabled');
    }
  }

  /*基础情景改变的时候，基础日期随之改变*/
  function changeJcqj(t) {
    var index = $(t).val();
    var selectJcqj = basisArr[index];
    var pt = qjType == 1 ? (selectJcqj.pathDate ? selectJcqj.pathDate : moment().add(-1, 'd')) : selectJcqj.pathDate;
    var dateArr = setSelectDate(selectJcqj.scenarinoStartDate, selectJcqj.scenarinoEndDate, pt);
    if (qjType == 2) {
      dateArr = dateArr.reverse();
    }
    $('#jcdate').empty();
    for (var i = 0; i < dateArr.length; i++) {
      $('#jcdate').append($('<option value="' + dateArr[i] + '">' + dateArr[i] + '</option>'))
    }
    var startD = dateArr[0] ? moment(moment(dateArr[0])).add(1, 'd').format('YYYY-MM-DD') : '';
    $('#yStartDate').empty().append($('<option value="' + startD + '">' + startD + '</option>'));

    if ($('#yStartDate').val() == '') {
      $('#yEndDate').empty();
      return;
    }
    var endDateArr = setSelectDate($('#yStartDate').val(), selectEndDate);
    $('#yEndDate').empty();
    for (var i = 0; i < endDateArr.length; i++) {
      if (qjType == 1) {
        if (endDateArr[i] < moment().format('YYYY-MM-DD'))continue;
        $('#yEndDate').append($('<option value="' + endDateArr[i] + '">' + endDateArr[i] + '</option>'))
      } else if (qjType == 2) {
        if (endDateArr[i] < moment(startD).format('YYYY-MM-DD'))continue;
        $('#yEndDate').append($('<option value="' + endDateArr[i] + '">' + endDateArr[i] + '</option>'))
      }
    }
  }
  function changeJcDate(t) {
    var date = $(t).val();
    var startD = moment(moment(date)).add(1, 'd').format('YYYY-MM-DD');
    $('#yStartDate').empty().append($('<option value="' + startD + '">' + startD + '</option>'));

    var endDateArr = setSelectDate($('#yStartDate').val(), selectEndDate);
    $('#yEndDate').empty();
    for (var i = 0; i < endDateArr.length; i++) {
      if (qjType == 1) {
        if (endDateArr[i] < moment().format('YYYY-MM-DD'))continue;
        $('#yEndDate').append($('<option value="' + endDateArr[i] + '">' + endDateArr[i] + '</option>'))
      } else if (qjType == 2) {
        if (endDateArr[i] < moment(startD).format('YYYY-MM-DD'))continue;
        $('#yEndDate').append($('<option value="' + endDateArr[i] + '">' + endDateArr[i] + '</option>'))
      }
    }
  }
  /*新改情景创建*/
  function createQj(type) {
    console.log(subBtn);
    if (!subBtn)return;
    subBtn = false;
    var url, urlName;
    var params, paramsName;
    url = '/ampc/scenarino/save_scenarino';
    urlName = '/ampc/scenarino/check_scenarinoname';
    if (type == 'ypg') {

      if ($('#yqjForm').valid()) {
        params = {};
        paramsName = {};
        params.scenarinoName = paramsName.scenarinoName = $('#yName').val();
        params.userId = paramsName.userId = userId;
        params.missionId = paramsName.missionId = selectRW.missionId;
        params.missionType = selectRW.missionStatus;
        params.scenType = qjType;
        params.scenarinoStartDate = '';
        params.scenarinoEndDate = '';
        params.basisScenarinoId = '';
        params.basisTime = '';
        params.controstScenarinoId = '';
        params.spinUp = '';

        if (qjType == 1) {
          params.scenarinoStartDate = moment($('#yStartDate').val()).format('YYYY-MM-DD HH:mm:ss');
          params.scenarinoEndDate = moment($('#yEndDate').val()).add(1, 'd').subtract(1, 's').format('YYYY-MM-DD HH:mm:ss');
          params.basisScenarinoId = basisArr[$('#jcqj').val()].scenarinoId;
          params.basisTime = moment($('#jcdate').val()).format('YYYY-MM-DD HH:mm:ss');
        } else if (qjType == 2) {
          if ($('.dbqj input[type=checkbox]')[0].checked) {
            params.controstScenarinoId = basisArr[$('#dbqj').val()].scenarinoId;
          } else {
            params.scenarinoStartDate = moment($('#yStartDate').val()).format('YYYY-MM-DD HH:mm:ss');
            params.scenarinoEndDate = moment($('#yEndDate').val()).add(1, 'd').subtract(1, 's').format('YYYY-MM-DD HH:mm:ss');
            params.basisScenarinoId = basisArr[$('#jcqj').val()].scenarinoId;
            params.basisTime = moment($('#jcdate').val()).format('YYYY-MM-DD HH:mm:ss');
          }
        }

        ajaxPost(urlName, paramsName).success(function (res) {
          if (res.data) {
            ajaxPost(url, params).success(function () {
              reloadTreegrid();
              subBtn = true;
              $("#addYQJ").window('close');
              swal({
                title: '添加成功!',
                type: 'success',
                timer: 1000,
                showConfirmButton: false
              });
              $('#yName').val('');
              //swal('添加成功', '', 'success')
            }).error(function () {
              swal({
                title: '添加失败!',
                type: 'error',
                timer: 1000,
                showConfirmButton: false
              });
              //swal('添加失败', '', 'error')
            })
          } else {
            swal({
              title: '名称重复!',
              type: 'error',
              timer: 1000,
              showConfirmButton: false
            });
            //swal('名称重复', '', 'error')
            subBtn = true;
          }
        }).error(function () {
          swal({
            title: '校验失败!',
            type: 'error',
            timer: 1000,
            showConfirmButton: false
          });
          //swal('校验失败', '', 'error')
          subBtn = true;
        })
      }


    } else {

      if ($('#hqjForm').valid()) {
        params = {};
        paramsName = {};
        params.scenarinoName = paramsName.scenarinoName = $('#hName').val();
        params.missionId = paramsName.missionId = selectRW.missionId;
        params.missionType = selectRW.missionStatus;
        params.userId = paramsName.userId = userId;
        params.scenType = qjType;
        params.scenarinoStartDate = '';
        params.scenarinoEndDate = '';
        params.basisScenarinoId = '';
        params.basisTime = '';
        params.controstScenarinoId = '';
        params.spinUp = '';
        if (qjType == 2) {
          if ($('.dbqj1 input[type=checkbox]')[0].checked) {
            params.controstScenarinoId = basisArr[$('#dbqj1').val()].scenarinoId;
          } else {
            params.scenarinoStartDate = moment($('#hStartDate').val()).format('YYYY-MM-DD HH:mm:ss');
            params.scenarinoEndDate = moment($('#hEndDate').val()).add(1, 'd').subtract(1, 's').format('YYYY-MM-DD HH:mm:ss');
            params.basisScenarinoId = basisArr[$('#jcqj1').val()].scenarinoId;
            params.basisTime = moment($('#jcdate1').val()).format('YYYY-MM-DD HH:mm:ss');
          }
        } else if (qjType == 3) {
          params.scenarinoStartDate = moment($('#hStartDate').val()).format('YYYY-MM-DD HH:mm:ss');
          params.scenarinoEndDate = moment($('#hEndDate').val()).add(1, 'd').subtract(1, 's').format('YYYY-MM-DD HH:mm:ss');
          params.spinUp = $('#spinup').val();
        }

        ajaxPost(urlName, paramsName).success(function (res) {
          if (res.data) {
            ajaxPost(url, params).success(function () {
              $('#qjTable').bootstrapTable('destroy');
              initQjTable();
              $('#createHpQjModal').modal('hide');
              $('#createYpQjModal').modal('hide');
              swal({
                title: '添加成功!',
                type: 'success',
                timer: 1000,
                showConfirmButton: false
              });
              //swal('添加成功', '', 'success')
              $('#hName').val('')
            }).error(function () {
              swal({
                title: '添加失败!',
                type: 'error',
                timer: 1000,
                showConfirmButton: false
              });
              //swal('添加失败', '', 'error')
            })
          } else {
            swal({
              title: '名称重复!',
              type: 'error',
              timer: 1000,
              showConfirmButton: false
            });
            //swal('名称重复', '', 'error')
            subBtn = true;
          }
        }).error(function () {
          swal({
            title: '校验失败!',
            type: 'error',
            timer: 1000,
            showConfirmButton: false
          });
          //swal('校验失败', '', 'error')
          subBtn = true;
        })
      }

    }

  }
</script>