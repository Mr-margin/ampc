<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div id="chartbox" style="height: 600px;width: 1000px">

</div>
<script src="../../js/plugins/echarts/echarts.min.js"></script>
<script src="../../js/moment.min.js"></script>
<script>
    var qjMsg = {
        rwId: 412,
        rwName: "杨磊预评估任务",
        qjId: 609,
        qjName: "预评估情景杨磊0502",
        qjStartDate: 1493568000000,
        qjEndDate: 1493999999000,
        esCouplingId: 1,
        esCouplingName: "2015年河北省清单",
        rwType: "2",
        esCodeRange: [
            "11", "12", "13"
        ],
        scenarinoStatus: 6,
        scenarinoStatuName: "模式执行中",
        SCEN_TYPE: "1"
    };
    var data = {
        "status": 0,
        "msg": "success",
        "data": [{
            "areaId": 1449,
            "areaName": "第一区域",
            "timeItems": [{
                "timeEndDate": 1493625599000,
                "timeId": 1873,
                "timeStartDate": 1493568000000,
                "planName": "123",
                "planId": 528
            }, {
                "timeEndDate": 1493999999000,
                "timeId": 1874,
                "timeStartDate": 1493625600000,
                "planName": "无",
                "planId": -1
            }],
            "provinceCodes": [{
                "110000": "北京市"
            }, {
                "120000": "天津市"
            }, {
                "130000": "河北省"
            }, {
                "140000": "山西省"
            }, {
                "150000": "内蒙古自治区"
            }, {
                "810000": "香港特别行政区市区"
            }],
            "cityCodes": [],
            "countyCodes": []
        }, {
            "isnew": false
        }]
    };
    //  data={"status":0,"msg":"success","data":[{"areaId":1579,"areaName":"第一区域","timeItems":[{"timeEndDate":1493999999000,"timeId":2019,"timeStartDate":1493827200000,"planName":"无","planId":-1}],"provinceCodes":[{"110000":"北京市"}],"cityCodes":[],"countyCodes":[]},{"areaId":1580,"areaName":"第二区域","timeItems":[{"timeEndDate":1493999999000,"timeId":2020,"timeStartDate":1493827200000,"planName":"无","planId":-1}],"provinceCodes":[{"120000":"天津市"}],"cityCodes":[],"countyCodes":[]},{"areaId":1581,"areaName":"第三区域","timeItems":[{"timeEndDate":1493999999000,"timeId":2021,"timeStartDate":1493827200000,"planName":"无","planId":-1}],"provinceCodes":[{"130000":"河北省"}],"cityCodes":[],"countyCodes":[]},{"isnew":false}]};
    data.data.length-=1;
    var temp={};
    function transform(data) {
        temp.yAxisLabel=[]; //y轴刻度尺
        temp.seriesData=[]; //用于存储区域绘线点，是一个二维数组
        var _tempdate=moment(); //临时时间
        var _temparr=[]; //临时存储用的数组
        var _temparr1=[]; //临时存储用的数组1
        for(var i=0;i<data.data.length;i++){
            temp.yAxisLabel.push(data.data[i].areaName+'1',data.data[i].areaName,data.data[i].areaName+'2');
            temp.seriesData.push([]);
            for(var j=0;j<data.data[i].timeItems.length;j++){
                data.data[i].timeItems[j].timeEndDate=moment(data.data[i].timeItems[j].timeEndDate).startOf('hour').add(1,'hours')
                temp.seriesData[temp.seriesData.length-1].push([]);
                _tempdate=moment(data.data[i].timeItems[j].timeStartDate);
                _temparr=[];
                _temparr1=[];
                do{
                    _temparr.push([_tempdate.valueOf(),data.data[i].areaName+'1']);
                    _temparr1.unshift([_tempdate.valueOf(),data.data[i].areaName+'2']);
                    _tempdate.add(1,'hours');
                    console.log(!_tempdate.isAfter(data.data[i].timeItems[j].timeEndDate));
                }while (!_tempdate.isAfter(data.data[i].timeItems[j].timeEndDate));
                temp.seriesData[temp.seriesData.length-1][temp.seriesData[temp.seriesData.length-1].length-1]=_temparr.concat(_temparr1);
                _tempdate=moment(data.data[i].timeItems[j].timeStartDate);
                temp.seriesData[temp.seriesData.length-1][temp.seriesData[temp.seriesData.length-1].length-1].push([_tempdate.valueOf(),data.data[i].areaName+'1']);
            }
        }
    }
    transform(data);
    var mycharts = echarts.init(document.getElementById('chartbox'));
    var option = {
        xAxis: {
            type: 'time',
//      interval: 1000 * 3600*24,
            max:qjMsg.qjEndDate,
            min:qjMsg.qjStartDate,
            position:'top',
            axisLine:{
                show:false
            }
//      axisLabel: {
//        formatter: function (value, index) {
//
//        }
//      }
        },
        yAxis:{
            type:'category',
            data:temp.yAxisLabel
        },
        dataZoom: [{
            type: 'inside',
            throttle: 50
        }],
        series:(function () {
            var _temp=[];//存储返回数据
            for(var i=0;i<temp.seriesData.length;i++){
                for(var j=0;j<temp.seriesData[i].length;j++){
                    _temp.push({
                        type:'line',
                        lineStyle:{
                            normal:{
                                color:'#2F4554'
                            }
                        },
                        areaStyle: {
                            normal: {
                                color:'#2F4554'
                            }
                        },
//            showSymbol:false,
                        data:temp.seriesData[i][j]
                    });
                }
            }
            return _temp;
        })()
    };
    mycharts.setOption(option);
    var zr=mycharts.getZr();
    zr.on('click',function (params) {
        var pointInPixel = [params.offsetX, params.offsetY];
        var pointInGrid = mycharts.convertFromPixel('grid', pointInPixel);
        console.log(pointInGrid);
    })
</script>
</body>
</html>